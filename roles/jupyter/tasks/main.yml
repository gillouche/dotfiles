---
# tasks file for jupyterlab
- name: Install jupyter notebooks (Debian)
  apt:
    name: "jupyter-notebook"
    state: latest
  become: true
  when: ansible_facts['os_family'] == "Debian"

- name: Install jupyter notebooks (Arch)
  pacman:
    name: "{{ item }}"
    state: latest
  become: true
  with_items:
    - "jupyter-notebook"
    - "jupyterlab"
  when: ansible_distribution == "Archlinux"

- name: Check for jupyter directory
  stat:
    path: "/home/{{ target_user }}/.jupyter"
  register: jupyter_folder

- name: Create jupyter directory
  file:
    path: /home/{{ target_user }}/.jupyter
    state: directory
    owner: "{{ target_user }}"
    group: "{{ target_user }}"
    mode: 0755
  when: not jupyter_folder.stat.exists

- name: Create symlink jupyter notebook config json
  file:
    src: "{{ role_path }}/files/jupyter_notebook_config.json"
    dest: /home/{{ target_user }}/.jupyter/jupyter_notebook_config.json
    state: link

- name: Check for jupyterlab directory
  stat:
    path: "/home/{{ target_user }}/.jupyter/lab/user-settings"
  register: jupyterlab_folder

- name: Create jupyterlab directory
  file:
    path: /home/{{ target_user }}/.jupyter/lab/user-settings
    state: directory
    owner: "{{ target_user }}"
    group: "{{ target_user }}"
    mode: 0755
  when: not jupyterlab_folder.stat.exists

- name: Create symlink to jupyterlab config
  file: 
    src: "{{ role_path }}/files/{{ item }}"
    dest: "/home/{{ target_user }}/.jupyter/lab/user-settings/{{ item }}"
    state: link
  with_items: 
    - apputils-extension
    - codemirror-extension
    - extensionmanager-extension
    - notebook-extension

